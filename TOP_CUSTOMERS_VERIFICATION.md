# ุงูุชุญูู ูู ุญุณุงุจ ุฃูุถู ุงูุนููุงุก ุญุณุจ ุงูุฅููุงู โ

**ุงูุชุงุฑูุฎ:** 2025-10-27  
**ุงูุญุงูุฉ:** โ ุงูุญุณุงุจ ุตุญูุญ 100%

---

## ๐ ูุง ุชู ุงุฎุชุจุงุฑู

### SQL Query ุงููุณุชุฎุฏู:

```php
$topCustomersByRevenue = Customer::select('customers.id', 'customers.name', 'customers.email', 'customers.phone')
    ->selectRaw('SUM(orders.total_amount) as total_spent')  // โ SUM ูุฌูุน ูู ุงูุทูุจุงุช
    ->selectRaw('COUNT(orders.id) as orders_count')
    ->join('orders', 'customers.id', '=', 'orders.customer_id')
    ->whereIn('orders.status', $paidStatuses)  // paid, shipped, delivered
    ->whereBetween('orders.created_at', [$dateFrom, $dateTo])
    ->groupBy('customers.id', 'customers.name', 'customers.email', 'customers.phone')
    ->orderBy('total_spent', 'desc')
    ->limit(10)
    ->get();
```

---

## โ ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ ุงููุนูู

### ุงูุนููู #1: ูุญูุฏ ุญุงูุฏ

#### ูู Query:
```
ุงูุฅููุงู: 704.400 ุฏ.ู
ุนุฏุฏ ุงูุทูุจุงุช: 9
```

#### ุงูุชุญูู ุงููุฏูู (ุฌูุน ูู ุทูุจุงุชู):
```
ุทูุจ #9451268:  52.200 ุฏ.ู
ุทูุจ #1221201: 107.200 ุฏ.ู
ุทูุจ #8270790:  92.400 ุฏ.ู
ุทูุจ #7809666:  92.400 ุฏ.ู
ุทูุจ #2136540:  92.400 ุฏ.ู
ุทูุจ #9276287: 107.400 ุฏ.ู
ุทูุจ #8482093:  27.400 ุฏ.ู
ุทูุจ #9355503:  38.000 ุฏ.ู
ุทูุจ #6681693:  95.000 ุฏ.ู
โโโโโโโโโโโโโโโโโโโโโโโ
ุงููุฌููุน:     704.400 ุฏ.ู โ
```

**โ ุงููุชูุฌุฉ: ูุชุทุงุจู ุชูุงูุงู! Query ูุญุณุจ ูุฌููุน ุฌููุน ุงูุทูุจุงุช**

---

### ุงูุนููู #2: hbmnb

#### ูู Query:
```
ุงูุฅููุงู: 40.600 ุฏ.ู
ุนุฏุฏ ุงูุทูุจุงุช: 1
```

#### ุงูุชุญูู ุงููุฏูู:
```
ุทูุจ #2232562: 40.600 ุฏ.ู
โโโโโโโโโโโโโโโโโโโโโโโ
ุงููุฌููุน:     40.600 ุฏ.ู โ
```

**โ ุงููุชูุฌุฉ: ูุชุทุงุจู ุชูุงูุงู!**

---

## ๐ฏ ุงูุฎูุงุตุฉ

### ูุง ููุนูู ุงููุธุงู (ุงูุตุญูุญ):

```sql
SUM(orders.total_amount)  -- โ ูุฌูุน ุฌููุน ุทูุจุงุช ุงูุนููู
GROUP BY customers.id      -- โ ููู ุนููู ุนูู ุญุฏุฉ
```

**ูุซุงู:**
```
ุงูุนููู A ูุฏูู 3 ุทูุจุงุช:
  - ุทูุจ 1: 100 ุฏ.ู
  - ุทูุจ 2: 200 ุฏ.ู  
  - ุทูุจ 3: 150 ุฏ.ู
โ ุงูุฅููุงู ุงูููู: 450 ุฏ.ู โ (ูุฌููุน ุฌููุน ุงูุทูุจุงุช)
```

---

### ูุง ูุง ููุนูู ุงููุธุงู:

```sql
MAX(orders.total_amount)  -- โ ูุฐุง ูุนุทู ุฃุนูู ุทูุจ ููุท โ
AVG(orders.total_amount)  -- โ ูุฐุง ูุนุทู ูุชูุณุท ุงูุทูุจุงุช โ
```

**ูุซุงู ูู ูุงู ุฎุงุทุฆุงู:**
```
ุงูุนููู A ูุฏูู 3 ุทูุจุงุช:
  - ุทูุจ 1: 100 ุฏ.ู
  - ุทูุจ 2: 200 ุฏ.ู  
  - ุทูุจ 3: 150 ุฏ.ู

ูู ุงุณุชุฎุฏููุง MAX: 200 ุฏ.ู โ (ุฃุนูู ุทูุจ ููุท)
ูู ุงุณุชุฎุฏููุง AVG: 150 ุฏ.ู โ (ูุชูุณุท ุงูุทูุจุงุช)
```

---

## ๐ API Response Structure

### Endpoint:
```
GET /api/v1/reports/analytics/customers
```

### Response:
```json
{
  "success": true,
  "data": {
    "top_customers_by_revenue": [
      {
        "id": 8,
        "name": "ูุญูุฏ ุญุงูุฏ",
        "email": "customer@example.com",
        "phone": "+965...",
        "total_spent": 704.400,     // โ ูุฌููุน ุฌููุน ุทูุจุงุชู
        "orders_count": 9            // โ ุนุฏุฏ ุงูุทูุจุงุช
      },
      {
        "id": 9,
        "name": "hbmnb",
        "email": "...",
        "phone": "...",
        "total_spent": 40.600,       // โ ูุฌููุน ุฌููุน ุทูุจุงุชู
        "orders_count": 1            // โ ุนุฏุฏ ุงูุทูุจุงุช
      }
    ]
  }
}
```

---

## ๐ ููููุฉ ุงูุชุญูู

### ูู Frontend:

ุฅุฐุง ุฃุฑุฏุช ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ูู Frontend:

```javascript
// ุงุญุณุจ ูุนุฏู ุงูุฅููุงู ููู ุทูุจ
const averagePerOrder = customer.total_spent / customer.orders_count;

// ูุซุงู:
// ูุญูุฏ ุญุงูุฏ: 704.400 / 9 = 78.27 ุฏ.ู/ุทูุจ
// hbmnb: 40.600 / 1 = 40.60 ุฏ.ู/ุทูุจ
```

---

## โ ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช ุชุจุฏู ุฎุงุทุฆุฉ

### ุชุญูู ูู:

#### 1. ุงููุชุฑุฉ ุงูุฒูููุฉ:
```javascript
// ูู ุชุณุชุนุฑุถ ููุณ ุงููุชุฑุฉุ
date_from=2025-09-27
date_to=2025-10-27
```

#### 2. ุญุงูุฉ ุงูุทูุจุงุช:
```javascript
// ุงููุธุงู ูุญุณุจ ููุท:
status IN ('paid', 'shipped', 'delivered')

// ูุง ูุญุณุจ:
- pending
- awaiting_payment  
- cancelled
```

#### 3. ุชุงุฑูุฎ ุงูุทูุจุงุช:
```javascript
// ูุญุณุจ ุงูุทูุจุงุช ูู ุงููุชุฑุฉ ุงููุญุฏุฏุฉ ููุท
// ูุซูุงู: ูู ุงูุนููู ูุฏูู 20 ุทูุจ ุนุจุฑ ุงูุณูุฉ
// ููู ููุท 5 ุทูุจุงุช ูู ุขุฎุฑ 30 ููู
// โ ุณูุธูุฑ ูุฌููุน ุงูู 5 ุทูุจุงุช ููุท
```

---

## ๐ ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุนููู ุจุทูุจ ูุงุญุฏ

```
ุงูุนููู: hbmnb
ุงูุทูุจุงุช ูู ุงููุชุฑุฉ: 1 ุทูุจ (40.60 ุฏ.ู)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุฅููุงู ุงูููู: 40.60 ุฏ.ู โ
```

### ูุซุงู 2: ุนููู ุจุนุฏุฉ ุทูุจุงุช

```
ุงูุนููู: ูุญูุฏ ุญุงูุฏ
ุงูุทูุจุงุช ูู ุงููุชุฑุฉ: 9 ุทูุจุงุช
  52.20 + 107.20 + 92.40 + 92.40 + 92.40 + 107.40 + 27.40 + 38.00 + 95.00
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุฅููุงู ุงูููู: 704.40 ุฏ.ู โ
```

### ูุซุงู 3: ุนููู ุฎุงุฑุฌ ุงููุชุฑุฉ

```
ุงูุนููู: ุฃุญูุฏ
ุงูุทูุจุงุช ุงููููุฉ: 10 ุทูุจุงุช (1000 ุฏ.ู)
ููู ูู ุขุฎุฑ 30 ููู: 0 ุทูุจุงุช
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ุงูุฅููุงู ุงูููู: 0 ุฏ.ู (ูู ูุธูุฑ ูู ุงููุงุฆูุฉ) โ
```

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### Test SQL Query ูุจุงุดุฑุฉ:

```sql
SELECT 
    c.id,
    c.name,
    SUM(o.total_amount) as total_spent,
    COUNT(o.id) as orders_count
FROM customers c
INNER JOIN orders o ON c.id = o.customer_id
WHERE o.status IN ('paid', 'shipped', 'delivered')
  AND o.created_at BETWEEN '2025-09-27' AND '2025-10-27'
GROUP BY c.id, c.name
ORDER BY total_spent DESC
LIMIT 10;
```

---

## โ ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

### ุงููุธุงู ูุนูู ุจุดูู ุตุญูุญ 100%:

1. โ ูุญุณุจ **ูุฌููุน ุฌููุน ุทูุจุงุช** ุงูุนููู
2. โ **ูุง** ูุญุณุจ ุฃุนูู ุทูุจ ููุท
3. โ **ูุง** ูุญุณุจ ูุชูุณุท ุงูุทูุจุงุช
4. โ ูุญุณุจ ููุท ุงูุทูุจุงุช **ุงููุฏููุนุฉ** (paid, shipped, delivered)
5. โ ูุญุณุจ ููุท ุงูุทูุจุงุช **ูู ุงููุชุฑุฉ ุงููุญุฏุฏุฉ**
6. โ ุชู ุงูุชุญูู ูุฏููุงู ููุชุทุงุจู 100%

---

## ๐ง ุงูููู ุงููุณุคูู

| ุงูููู | Method | ุงูุญุงูุฉ |
|-------|--------|--------|
| `app/Http/Controllers/Api/ReportController.php` | `getCustomerAnalytics()` | โ ุตุญูุญ |

### ุงูููุฏ ุงููุณุชุฎุฏู:

```php
// ุงูุณุทุฑ 209-218
$topCustomersByRevenue = Customer::select('customers.id', 'customers.name', 'customers.email', 'customers.phone')
    ->selectRaw('SUM(orders.total_amount) as total_spent')  // โ SUM ุตุญูุญ
    ->selectRaw('COUNT(orders.id) as orders_count')
    ->join('orders', 'customers.id', '=', 'orders.customer_id')
    ->whereIn('orders.status', $paidStatuses)
    ->whereBetween('orders.created_at', [$dateFrom, $dateTo])
    ->groupBy('customers.id', 'customers.name', 'customers.email', 'customers.phone')
    ->orderBy('total_spent', 'desc')
    ->limit(10)
    ->get();
```

---

**๐ ุงููุธุงู ูุญุณุจ ูุฌููุน ุฌููุน ุทูุจุงุช ุงูุนููู ุจุดูู ุตุญูุญ!**

**ุฅุฐุง ูุงู ููุงู ูุดููุฉ ูู Frontendุ ูุฑุฌู ุงูุชุญูู ูู:**
- ุงููุชุฑุฉ ุงูุฒูููุฉ ุงููุณุชุฎุฏูุฉ
- ุญุงูุฉ ุงูุทูุจุงุช (paid/shipped/delivered ููุท)
- ุทุฑููุฉ ุนุฑุถ ุงูุจูุงูุงุช ูู ุงููุงุฌูุฉ

