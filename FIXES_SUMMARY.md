# ููุฎุต ุงูุฅุตูุงุญุงุช - Order Statistics & Payment Discount

## ุชุงุฑูุฎ ุงูุฅุตูุงุญ
**ุงูุชุงุฑูุฎ:** 2025-10-24

---

## ุงูุฅุตูุงุญ ุงูุฃูู: ูุดููุฉ ุชุทุจูู ุงูุฎุตู ุนูู ุงูุฏูุน ๐ฐ

### ุงููุดููุฉ
ุนูุฏ ุชุทุจูู ููุฏ ุฎุตู ุนูู ุทูุจุ ูุงู ูุชู ุญูุธ ุงูุฎุตู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญุ ููู ุนูุฏ ุชููุฆุฉ ุงูุฏูุน ูุน **MyFatoorah**ุ ูุงู ูุชู ุฅุฑุณุงู **ุงูุณุนุฑ ุงูุฃุตูู ูุจู ุงูุฎุตู** ุจุฏูุงู ูู ุงูุณุนุฑ ุงูููุงุฆู.

### ุงูููู ุงููุตูุญ
`app/Services/PaymentService.php`

### ุงูุชุนุฏููุงุช
1. ุฅุถุงูุฉ ุงูุฎุตู ูุนูุตุฑ ูููุตู ูู ูุงุชูุฑุฉ MyFatoorah
2. ุงุณุชุฎุฏุงู `$order->total_amount` (ุงูุณุนุฑ ุงูููุงุฆู ุจุนุฏ ุงูุฎุตู) ุจุฏูุงู ูู ุญุณุงุจ ุงููุฌููุน ูุฏููุงู

### ุงูููุฏ ูุจู ุงูุฅุตูุงุญ
```php
// ูุญุณุจ ููุท (ุงูููุชุฌุงุช + ุงูุดุญู)
'InvoiceValue' => $itemsTotal
```

### ุงูููุฏ ุจุนุฏ ุงูุฅุตูุงุญ
```php
// ุฅุถุงูุฉ ุงูุฎุตู ูุนูุตุฑ ูู ุงููุงุชูุฑุฉ
if ($order->discount_amount > 0) {
    $invoiceItems[] = [
        'ItemName' => 'ุฎุตู - ' . ($order->discount_code ?? 'ููุฏ ุงูุฎุตู'),
        'UnitPrice' => -(float)$order->discount_amount,
        // ...
    ];
}

// ุงุณุชุฎุฏุงู ุงูุณุนุฑ ุงูููุงุฆู ุงูุตุญูุญ
'InvoiceValue' => (float)$order->total_amount
```

### ุงููุชูุฌุฉ
โ ุงูุฏูุน ุงูุขู ูุชู ุจุงูุณุนุฑ ุงูุตุญูุญ ุจุนุฏ ุชุทุจูู ุงูุฎุตู

---

## ุงูุฅุตูุงุญ ุงูุซุงูู: ูุดููุฉ ููุชุฑ ุงูุฅุญุตุงุฆูุงุช ๐

### ุงููุดููุงุช
1. โ ููุชุฑ ุงูุญุงูุฉ (status) ูุง ูุนูู ูู API ุงูุฅุญุตุงุฆูุงุช
2. โ ููุชุฑ ุงูุชุงุฑูุฎ ูุง ูุชู ุชุทุจููู ุจุดูู ุตุญูุญ
3. โ ุญุณุงุจ ุงูุฅูุฑุงุฏุงุช ููุชูุณุท ูููุฉ ุงูุทูุจ ูุญุณุจ ููุท ููุญุงูุฉ `paid` ุจุฏูุงู ูู `paid + shipped + delivered`

### ุงููููุงุช ุงููุตูุญุฉ
1. `app/Http/Controllers/Api/Admin/OrderController.php`
   - ุฏุงูุฉ `statistics()` - ุฅุถุงูุฉ ููุชุฑ ุงูุญุงูุฉ + ุชุตุญูุญ ุญุณุงุจ ุงูุฅูุฑุงุฏุงุช
   - ุฏุงูุฉ `index()` - ุชุตุญูุญ ุญุณุงุจ ุงูุฅูุฑุงุฏุงุช ูู ุงูููุฎุต

2. `app/Http/Controllers/TempOrdersController.php`
   - ุฏุงูุฉ `statistics()` - ุชุตุญูุญ ุญุณุงุจ ุงูุฅูุฑุงุฏุงุช

### ุงูุชุนุฏููุงุช ุงูุฑุฆูุณูุฉ

#### 1. ุชุทุจูู ููุชุฑ ุงูุญุงูุฉ
```php
// ูุจู
$baseQuery = Order::whereBetween('created_at', [$startDate, $endDate]);

// ุจุนุฏ
$baseQuery = Order::whereBetween('created_at', [$startDate, $endDate]);
$statusFilter = $request->get('status');
$filteredQuery = clone $baseQuery;
if ($statusFilter) {
    $filteredQuery->where('status', $statusFilter);
}
```

#### 2. ุชุตุญูุญ ุญุณุงุจ ุงูุฅูุฑุงุฏุงุช
```php
// ูุจู - ูุญุณุจ ููุท paid
'total_revenue' => Order::where('status', 'paid')->sum('total_amount')

// ุจุนุฏ - ูุญุณุจ paid + shipped + delivered
$revenueStatuses = ['paid', 'shipped', 'delivered'];
'total_revenue' => Order::whereIn('status', $revenueStatuses)->sum('total_amount')
```

### ุงููุชุงุฆุฌ
โ ููุชุฑ ุงูุญุงูุฉ ูุนูู ุจุดูู ุตุญูุญ
โ ููุชุฑ ุงูุชุงุฑูุฎ ูุทุจู ุจุฏูุฉ
โ ุญุณุงุจ ุงูุฅูุฑุงุฏุงุช ูุดูู ุฌููุน ุงูุทูุจุงุช ุงููุคูุฏุฉ

---

## API ุงูุฐู ุชู ุฅุตูุงุญู

### Endpoint
```
GET /api/v1/admin/orders/statistics
```

### ุงููุนุงููุงุช ุงููุฏุนููุฉ
- `status` - ููุชุฑ ุญุณุจ ุญุงูุฉ ุงูุทูุจ (paid, shipped, delivered, etc.)
- `start_date` / `date_from` - ุชุงุฑูุฎ ุงูุจุฏุงูุฉ
- `end_date` / `date_to` - ุชุงุฑูุฎ ุงูููุงูุฉ
- `period` - ุนุฏุฏ ุงูุฃูุงู (ุงูุชุฑุงุถู: 30)

### ูุซุงู ุนูู ุงูุงุณุชุฎุฏุงู
```http
GET /api/v1/admin/orders/statistics?status=paid&start_date=2025-10-17&end_date=2025-10-24
```

### Response ุงูุขู
```json
{
  "success": true,
  "data": {
    "total_orders": 5,                    // โ ูุทุจู ููุชุฑ ุงูุญุงูุฉ
    "total_revenue": 125.500,             // โ ูุญุณุจ (paid + shipped + delivered)
    "average_order_value": 25.100,        // โ ูุญุณุจ (paid + shipped + delivered)
    "pending_orders": 10,                 // ุนุฏุฏ ุฌููุน ุงูุทูุจุงุช ุงููุนููุฉ ูู ุงููุชุฑุฉ
    "paid_orders": 5,                     // ุนุฏุฏ ุฌููุน ุงูุทูุจุงุช ุงููุฏููุนุฉ ูู ุงููุชุฑุฉ
    "shipped_orders": 3,                  // ุนุฏุฏ ุฌููุน ุงูุทูุจุงุช ุงููุดุญููุฉ ูู ุงููุชุฑุฉ
    "delivered_orders": 2,                // ุนุฏุฏ ุฌููุน ุงูุทูุจุงุช ุงููุณููุฉ ูู ุงููุชุฑุฉ
    "filters_applied": {
      "status": "paid",
      "start_date": "2025-10-17",
      "end_date": "2025-10-24"
    }
  }
}
```

---

## ุงูููุงุฆุฏ

### โ ูููุณุชุฎุฏููู
- ุฏูุน ุจุงูุณุนุฑ ุงูุตุญูุญ ุจุนุฏ ุงูุฎุตู
- ุฅุญุตุงุฆูุงุช ุฏูููุฉ ูููุซููุฉ
- ุชูุงุฑูุฑ ูุงููุฉ ุตุญูุญุฉ

### โ ูููุทูุฑูู
- ููุฏ ุฃูุซุฑ ูุถูุญุงู ููุงุจููุฉ ููุตูุงูุฉ
- ููุทู ููุญุฏ ุนุจุฑ ุฌููุน Controllers
- ุชูุซูู ุดุงูู ููุชุบููุฑุงุช

### โ ููุฃุนูุงู
- ุญุณุงุจุงุช ุฅูุฑุงุฏุงุช ุฏูููุฉ
- ุชุชุจุน ุฃูุถู ูุฃุฏุงุก ุงููุจูุนุงุช
- ูุฑุงุฑุงุช ูุจููุฉ ุนูู ุจูุงูุงุช ุตุญูุญุฉ

---

## ูููุงุช ุงูุงุฎุชุจุงุฑ

ุชู ุฅูุดุงุก ููู ุงุฎุชุจุงุฑ ููุชุญูู ูู ุงูุฅุตูุงุญุงุช:
```bash
php test_order_statistics_fix.php
```

---

## ุงูุชูุซูู ุงูุชูุตููู

ูููุฒูุฏ ูู ุงูุชูุงุตููุ ุฑุงุฌุน:
- `ORDER_STATISTICS_FIX_DOCUMENTATION.md` - ุชูุซูู ุชูุตููู ูุฅุตูุงุญ ุงูุฅุญุตุงุฆูุงุช
- `PAYMENT_APIS_GUIDE.md` - ุฏููู APIs ุงูุฏูุน
- `ORDER_MANAGEMENT_DOCUMENTATION.md` - ุชูุซูู ุฅุฏุงุฑุฉ ุงูุทูุจุงุช

---

---

## ุงูุฅุตูุงุญ ุงูุซุงูุซ: ูุดููุฉ ุจูุงูุงุช ุงูุนููุงุก ๐ฅ

### ุงููุดููุฉ
ุนูุฏ ุงุณุชุฏุนุงุก API ุงูุนููุงุก `GET /api/v1/admin/customers?page=1&per_page=15`ุ ูุงูุช ุงูุจูุงูุงุช ุงููููุฉ ููู ุนููู ุชุฑุฌุน ุจูููุฉ `0` ุฃู `null`:
1. โ `average_order_value` ูุฑุฌุน 0
2. โ `total_orders` ูุง ูุฑุฌุน ุจุดูู ุตุญูุญ
3. โ `total_spent` ูุง ูุฑุฌุน ุจุดูู ุตุญูุญ

### ุงูุณุจุจ
API ูุงู ูุนุชูุฏ ุนูู ุญููู ูุฎุฒูุฉ ูู ุฌุฏูู `customers` ูู ุชูู ูุญุฏุซุฉ ุชููุงุฆูุงู.

### ุงููููุงุช ุงููุตูุญุฉ
1. `app/Http/Controllers/Api/Admin/CustomerController.php`
   - ุฏุงูุฉ `index()` - ุญุณุงุจ ุงูููู ุฏููุงููููุงู

2. `app/Services/CustomerService.php`
   - ุฏุงูุฉ `getCustomerDetails()` - ุญุณุงุจ ุงูููู ููุนููู ุงููุงุญุฏ
   - ุฏุงูุฉ `searchCustomers()` - ุญุณุงุจ ุงูููู ูู ุงูุจุญุซ

### ุงูุญู
ุงุณุชุฎุฏุงู Laravel's aggregate methods ูุญุณุงุจ ุงูููู ุฏููุงููููุงู:

```php
// ูุจู - ูุนุชูุฏ ุนูู ุญููู ูุฎุฒูุฉ ูุฏ ุชููู 0
$query = Customer::with(['latestOrder']);

// ุจุนุฏ - ูุญุณุจ ุงูููู ุฏููุงููููุงู ูู ุงูุทูุจุงุช
$query = Customer::with(['latestOrder'])
    ->withCount('orders as total_orders')
    ->withSum('orders as calculated_total_spent', 'total_amount')
    ->withAvg('orders as calculated_average_order_value', 'total_amount');
```

### ุงููุชุงุฆุฌ
โ ูู ุนููู ูุฑุฌุน ุงูุจูุงูุงุช ุงูุตุญูุญุฉ:
- `total_orders` - ุนุฏุฏ ุงูุทูุจุงุช ุงููุนูู
- `total_spent` - ุงููุจูุบ ุงูุฅุฌูุงูู ุงููุนูู
- `average_order_value` - ุงููุชูุณุท ุงููุนูู

---

## ุงูุฎูุงุตุฉ ุงูููุงุฆูุฉ

ุชู ุฅุตูุงุญ **3 ูุดููุงุช ุฑุฆูุณูุฉ** ุจูุฌุงุญ! ๐

### โ ุงูุฅุตูุงุญ ุงูุฃูู: ุงูุฎุตู ุนูู ุงูุฏูุน
- ุงูุฏูุน ุงูุขู ูุชู ุจุงูุณุนุฑ ุงูุตุญูุญ ุจุนุฏ ุชุทุจูู ุงูุฎุตู
- ุงูุฎุตู ูุธูุฑ ูู ูุงุชูุฑุฉ MyFatoorah

### โ ุงูุฅุตูุงุญ ุงูุซุงูู: ููุชุฑ ุงูุฅุญุตุงุฆูุงุช
- ููุชุฑ ุงูุญุงูุฉ ูุนูู ุจุดูู ุตุญูุญ
- ููุชุฑ ุงูุชุงุฑูุฎ ูุทุจู ุจุฏูุฉ
- ุญุณุงุจ ุงูุฅูุฑุงุฏุงุช ุตุญูุญ (paid + shipped + delivered)

### โ ุงูุฅุตูุงุญ ุงูุซุงูุซ: ุจูุงูุงุช ุงูุนููุงุก
- `average_order_value` ูุฑุฌุน ุงููููุฉ ุงูุตุญูุญุฉ
- `total_orders` ูุฑุฌุน ุนุฏุฏ ุงูุทูุจุงุช ุงููุนูู
- `total_spent` ูุฑุฌุน ุงููุฌููุน ุงููุนูู

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูู ุงูุฅูุชุงุฌ! ๐**

