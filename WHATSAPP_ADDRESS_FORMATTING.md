# ุชูุณูู ุนููุงู ุงูุดุญู ูู ุฑุณุงุฆู ุงููุงุชุณุงุจ ๐

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ุชูุณูู ุชููุงุฆู ูุนููุงู ุงูุดุญู ูู ุฑุณุงุฆู ุงููุงุชุณุงุจ ููุธูุฑ ุจุดูู ููุฑูุก ุจุฏูุงู ูู JSON.

---

## ุงููุดููุฉ ุงูุณุงุจูุฉ โ

```
*ุนููุงู ุงูุชูุตูู:*
{"street":"jhgj hjfvbn hv","city":"ุงููุทุงุฑ","governorate":"ูุญุงูุธุฉ ุงููุฑูุงููุฉ","postal_code":null}
```

---

## ุงูุญู ุงูุฌุฏูุฏ โ

```
*ุนููุงู ุงูุชูุตูู:*
ุงูุดุงุฑุน: jhgj hjfvbn hv
ุงููุฏููุฉ: ุงููุทุงุฑ
ุงููุญุงูุธุฉ: ูุญุงูุธุฉ ุงููุฑูุงููุฉ
```

---

## ููู ูุนููุ

### 1. ุงูุชุนุฑู ุนูู ููุน ุงูุนููุงู

```php
private function formatAddress($address)
{
    // ูุต ุนุงุฏูุ โ ุฅุฑุฌุงุนู ููุง ูู
    if (is_string($address) && !$this->isJson($address)) {
        return $address;
    }

    // JSON stringุ โ ูู ุงูุชุดููุฑ
    if (is_string($address)) {
        $address = json_decode($address, true);
    }

    // Arrayุ โ ุชูุณููู ุจุดูู ููุฑูุก
    if (is_array($address)) {
        // ...
    }
}
```

---

### 2. ุงูุญููู ุงููุฏุนููุฉ

ูุชู ุนุฑุถ ุงูุญููู ุงูุชุงููุฉ (ุฅุฐุง ููุฌุฏุช):

| ุงูุญูู | ุงูุงุณู ุงูุนุฑุจู |
|-------|-------------|
| `street` | ุงูุดุงุฑุน |
| `city` | ุงููุฏููุฉ |
| `governorate` | ุงููุญุงูุธุฉ |
| `postal_code` | ุงูุฑูุฒ ุงูุจุฑูุฏู |
| `block` | ุงููุทุนุฉ |
| `building` | ุงูุจูุงูุฉ |
| `floor` | ุงูุทุงุจู |
| `apartment` | ุงูุดูุฉ |
| `notes` | ููุงุญุธุงุช |

---

### 3. ุฃูุซูุฉ

#### ูุซุงู 1: ุนููุงู ูุงูู

**Input:**
```json
{
  "street": "ุดุงุฑุน ุงูุฎููุฌ",
  "city": "ุงูุณุงูููุฉ",
  "governorate": "ูุญุงูุธุฉ ุญููู",
  "block": "5",
  "building": "123",
  "floor": "3",
  "apartment": "12",
  "postal_code": "12345"
}
```

**Output:**
```
ุงูุดุงุฑุน: ุดุงุฑุน ุงูุฎููุฌ
ุงููุฏููุฉ: ุงูุณุงูููุฉ
ุงููุญุงูุธุฉ: ูุญุงูุธุฉ ุญููู
ุงูุฑูุฒ ุงูุจุฑูุฏู: 12345
ุงููุทุนุฉ: 5
ุงูุจูุงูุฉ: 123
ุงูุทุงุจู: 3
ุงูุดูุฉ: 12
```

---

#### ูุซุงู 2: ุนููุงู ุจุณูุท

**Input:**
```json
{
  "street": "ุดุงุฑุน 15",
  "city": "ุงููุทุงุฑ",
  "governorate": "ูุญุงูุธุฉ ุงููุฑูุงููุฉ"
}
```

**Output:**
```
ุงูุดุงุฑุน: ุดุงุฑุน 15
ุงููุฏููุฉ: ุงููุทุงุฑ
ุงููุญุงูุธุฉ: ูุญุงูุธุฉ ุงููุฑูุงููุฉ
```

---

#### ูุซุงู 3: ูุต ุนุงุฏู

**Input:**
```
"ุงููููุชุ ุงูุณุงูููุฉุ ุดุงุฑุน ุงูุฎููุฌุ ุจูุงูุฉ 123"
```

**Output:**
```
ุงููููุชุ ุงูุณุงูููุฉุ ุดุงุฑุน ุงูุฎููุฌุ ุจูุงูุฉ 123
```
(ููุนุฑุถ ููุง ูู ุจุฏูู ุชุบููุฑ)

---

## ุงูุงุณุชุฎุฏุงู

### ูู ุฑุณุงูุฉ ุงูุฃุฏูู

```php
// Shipping Address
if ($order->shipping_address) {
    $message .= "*ุนููุงู ุงูุดุญู:*\n";
    $address = $this->formatAddress($order->shipping_address);
    $message .= "{$address}\n\n";
}
```

---

### ูู ุฑุณุงูุฉ ุงูููุฏูุจ

```php
// ุนููุงู ุงูุชูุตูู (ููู ุฌุฏุงู ููููุฏูุจ)
$message .= "*ุนููุงู ุงูุชูุตูู:*\n";
if ($order->shipping_address) {
    $address = $this->formatAddress($order->shipping_address);
    $message .= "{$address}\n\n";
} else {
    $message .= "(ูู ูุชู ุชุญุฏูุฏ ุงูุนููุงู)\n\n";
}
```

---

## ุงูููุฒุงุช

### โ ูุฏุนู ุฃููุงุน ูุฎุชููุฉ:
- JSON string
- PHP array
- ูุต ุนุงุฏู

### โ ุขูู ุชูุงูุงู:
- ูุชุญูู ูู ููุน ุงูุจูุงูุงุช
- ูุชุนุงูู ูุน ุงูุฃุฎุทุงุก ุจุดูู ุตุญูุญ
- ูุนุฑุถ "ุบูุฑ ูุญุฏุฏ" ูู ุญุงูุฉ ุงููุดู

### โ ูุฑู:
- ูุนุฑุถ ููุท ุงูุญููู ุงูููุฌูุฏุฉ
- ูุชุฌุงูู ุงูุญููู ุงููุงุฑุบุฉ (`null`, `""`)
- ูุญุงูุธ ุนูู ุงููุตูุต ุงูุนุงุฏูุฉ ููุง ูู

---

## ุงูุฃูุงู ูุงูุฃุฎุทุงุก

### 1. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

```php
try {
    if ($order->shipping_address) {
        $address = $this->formatAddress($order->shipping_address);
    }
} catch (\Exception $ex) {
    // If formatting fails, keep it as 'ุบูุฑ ูุญุฏุฏ'
}
```

---

### 2. ุงูุชุญูู ูู JSON

```php
private function isJson($string)
{
    if (!is_string($string)) {
        return false;
    }
    
    json_decode($string);
    return json_last_error() === JSON_ERROR_NONE;
}
```

---

### 3. Fallback

ุฅุฐุง ูุดู ุงูุชูุณูู ุฃู ูุงู ุงูุนููุงู ูุงุฑุบุงู:
```
ุบูุฑ ูุญุฏุฏ
```

---

## ุงููููุงุช ุงููุนุฏูุฉ

### `app/Services/WhatsAppService.php`

**ุชู ุฅุถุงูุฉ:**
1. `private function formatAddress($address)` - ุชูุณูู ุงูุนููุงู
2. `private function isJson($string)` - ุงูุชุญูู ูู JSON

**ุชู ุชุนุฏูู:**
1. `formatOrderMessage()` - ุฑุณุงูุฉ ุงูุฃุฏูู
2. `formatDeliveryMessage()` - ุฑุณุงูุฉ ุงูููุฏูุจ

---

## ุงูุงุฎุชุจุงุฑ

```bash
php test_whatsapp_notification.php
```

ุณุชุธูุฑ ุงูุฑุณุงุฆู ุจุนูุงููู ููุณูุฉ ุจุดูู ููุฑูุก.

---

## ุฃูุซูุฉ ูู ุงููุงูุน

### ูุจู ุงูุชุญุฏูุซ โ

```
*ุนููุงู ุงูุชูุตูู:*
{"street":"jhgj hjfvbn hv","city":"ุงููุทุงุฑ","governorate":"ูุญุงูุธุฉ ุงููุฑูุงููุฉ","postal_code":null}
```

### ุจุนุฏ ุงูุชุญุฏูุซ โ

```
*ุนููุงู ุงูุชูุตูู:*
ุงูุดุงุฑุน: jhgj hjfvbn hv
ุงููุฏููุฉ: ุงููุทุงุฑ
ุงููุญุงูุธุฉ: ูุญุงูุธุฉ ุงููุฑูุงููุฉ
```

---

## ุงูุฎูุงุตุฉ

โ **ุชูุณูู ุชููุงุฆู** ููุนูุงููู ุงูููุธูุฉ (JSON/Array)  
โ **ูุญุงูุธ ุนูู ุงููุตูุต ุงูุนุงุฏูุฉ** ููุง ูู  
โ **ุขูู ููุฑู** ูุน ูุนุงูุฌุฉ ูุงููุฉ ููุฃุฎุทุงุก  
โ **ูุนูู ูู ููุง ุงูุฑุณุงูุชูู** (ุงูุฃุฏูู ูุงูููุฏูุจ)  

**ุฌุงูุฒ ููุงุณุชุฎุฏุงู! ๐โจ**

